{% extends "base_map_split.html" %}

{% block details %} 
	<h2>Triggered Alerts</h2> 
	<p>Listed below are all the alerts that have been triggered.</p>
	<form action="#" method="post">
	<div id="gps-table">
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th></th>
				<th><i class="icon-check"></i></th>
				<th>Alert</th>
				<th>Time</th>
			</tr>
		</thead>
		<tbody style="cursor: pointer;">
{% for alertGroup in alertsArrays %}
<tr onclick="onRowClick('{{ alertGroup.0.location_log.lat }}', '{{ alertGroup.0.location_log.long }}', '','');">
	<td><div id="color-{{ forloop.counter }}">●</div></td>
	<td> <input type="checkbox" name="alertCheckBox" value="{{ alertGroup.0.alert.id }}"/></td>
	<td>{{alertGroup.0.alert}}</td>
	<td>{{alertGroup.0.location_log.timestamp|date:"Y-m-d H:i"}}</td>
</tr>
	{% endfor %}
		</tbody>
	</table>
	</div>	
  </form>	
{% endblock details %}

{% block extendedFunction %}
function extendedFunction()
{  
	var marker;
	{% if alertsArrays %}
		{% for alertGroup in alertsArrays %}
			{% for alertLog in alertGroup %}
				marker = createMarker(
				new google.maps.LatLng({{ alertLog.location_log.lat }},{{ alertLog.location_log.long }}),
				'{{ alertLog.location_log.timestamp }} <br> {{ alertLog.location_log.speed }} kph',
				'{{ alertLog.location_log.timestamp }}',
				"{{ STATIC_URL }}img/spot.png",
				{{ forloop.counter }},{{forloop.parentloop.counter}}-1);
				markerArray[{{forloop.parentloop.counter}}-1][{{forloop.counter}}] = marker;
				latlngbounds.extend( marker.getPosition() );
			{% endfor %}
				AddLine({{ forloop.counter }}-1 , 0);//(lineNumber , reverse=false);
				var row = document.getElementById("color-{{ forloop.counter }}").style.color = lineColors[{{ forloop.counter }}-1];;
		{% endfor %}
				map.fitBounds( latlngbounds );
	{% endif %}

}
{% endblock extendedFunction%}							
